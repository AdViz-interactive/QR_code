<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Designer QR Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- QR Code Styling Library -->
    <script src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .color-input-wrapper {
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 40px;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }
        .color-input-wrapper input[type="color"] {
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            cursor: pointer;
            border: none;
            padding: 0;
            margin: 0;
        }
        /* Custom scrollbar for style panel */
        .style-panel::-webkit-scrollbar {
            width: 6px;
        }
        .style-panel::-webkit-scrollbar-track {
            background: transparent;
        }
        .style-panel::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 20px;
        }
        
        #qr-code-container canvas {
            max-width: 100%;
            height: auto !important;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-radius: 1rem;
        }
        .preset-btn {
            transition: all 0.2s;
        }
        .preset-btn:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden text-slate-800">

    <!-- Navbar -->
    <nav class="bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between shrink-0 z-10">
        <div class="flex items-center gap-2">
            <div class="bg-indigo-600 p-2 rounded-lg text-white">
                <i data-lucide="qr-code" class="w-6 h-6"></i>
            </div>
            <h1 class="text-xl font-bold tracking-tight text-slate-900">Designer QR Studio</h1>
        </div>
        <div class="hidden md:flex text-sm text-slate-500">
            Create high-res, styled QR codes instantly.
        </div>
    </nav>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col md:flex-row overflow-hidden">
        
        <!-- Left Panel: Controls -->
        <div class="w-full md:w-1/2 lg:w-1/3 bg-white border-r border-slate-200 flex flex-col h-full overflow-hidden">
            <div class="p-6 border-b border-slate-100 bg-slate-50">
                <label class="block text-sm font-semibold text-slate-700 mb-2">Content</label>
                <div class="relative">
                    <i data-lucide="link" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
                    <input type="text" id="urlInput" value="https://example.com" placeholder="Enter URL or Text" 
                        class="w-full pl-10 pr-4 py-3 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition text-slate-700 text-sm">
                </div>
            </div>

            <!-- Scrollable Settings -->
            <div class="flex-1 overflow-y-auto style-panel p-6 space-y-8">

                 <!-- Presets -->
                 <section>
                    <div class="flex items-center gap-2 mb-4">
                        <i data-lucide="wand-2" class="w-4 h-4 text-indigo-600"></i>
                        <h3 class="font-semibold text-slate-800">Quick Presets</h3>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="applyPreset('fluid')" class="preset-btn flex flex-col items-center gap-2 p-3 rounded-lg border border-slate-200 bg-slate-50 hover:border-red-300 hover:bg-red-50">
                            <div class="w-8 h-8 rounded bg-red-800" style="border-radius: 50% 20% / 10% 40%;"></div>
                            <span class="text-xs font-medium text-slate-600">Fluid Red</span>
                        </button>
                         <button onclick="applyPreset('elegant')" class="preset-btn flex flex-col items-center gap-2 p-3 rounded-lg border border-slate-200 bg-slate-50 hover:border-blue-300 hover:bg-blue-50">
                            <div class="w-8 h-8 rounded bg-blue-900 flex items-center justify-center">
                                <div class="w-2 h-4 bg-white/30 rounded-full"></div>
                            </div>
                            <span class="text-xs font-medium text-slate-600">Elegant Blue</span>
                        </button>
                        <button onclick="applyPreset('modern')" class="preset-btn flex flex-col items-center gap-2 p-3 rounded-lg border border-slate-200 bg-slate-50 hover:border-indigo-300 hover:bg-indigo-50">
                            <div class="w-8 h-8 rounded bg-indigo-600"></div>
                            <span class="text-xs font-medium text-slate-600">Modern Box</span>
                        </button>
                        <button onclick="applyPreset('dots')" class="preset-btn flex flex-col items-center gap-2 p-3 rounded-lg border border-slate-200 bg-slate-50 hover:border-emerald-300 hover:bg-emerald-50">
                            <div class="w-8 h-8 rounded-full bg-emerald-600 border-4 border-white ring-1 ring-slate-200"></div>
                            <span class="text-xs font-medium text-slate-600">Minimal Dot</span>
                        </button>
                    </div>
                </section>

                <hr class="border-slate-100">
                
                <!-- Dot Styles -->
                <section>
                    <div class="flex items-center gap-2 mb-4">
                        <i data-lucide="grid-3x3" class="w-4 h-4 text-indigo-600"></i>
                        <h3 class="font-semibold text-slate-800">Pattern & Dots</h3>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-medium text-slate-500 mb-1">Style</label>
                            <select id="dotsType" class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:border-indigo-500">
                                <option value="square">Square</option>
                                <option value="dots">Dots</option>
                                <option value="rounded">Rounded</option>
                                <option value="extra-rounded">Extra Rounded</option>
                                <option value="classy">Classy</option>
                                <option value="classy-rounded">Classy Rounded</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-slate-500 mb-1">Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="dotsColor" value="#4f46e5">
                            </div>
                        </div>
                    </div>
                </section>

                <hr class="border-slate-100">

                <!-- Corner Styles -->
                <section>
                    <div class="flex items-center gap-2 mb-4">
                        <i data-lucide="frame" class="w-4 h-4 text-indigo-600"></i>
                        <h3 class="font-semibold text-slate-800">Corner Markers</h3>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-medium text-slate-500 mb-1">Square Shape</label>
                                <select id="cornersSquareType" class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:border-indigo-500">
                                    <option value="square">Square</option>
                                    <option value="dot">Dot</option>
                                    <option value="extra-rounded">Extra Rounded</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-slate-500 mb-1">Square Color</label>
                                <div class="color-input-wrapper">
                                    <input type="color" id="cornersSquareColor" value="#312e81">
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-medium text-slate-500 mb-1">Center Dot Shape</label>
                                <select id="cornersDotType" class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:border-indigo-500">
                                    <option value="square">Square</option>
                                    <option value="dot">Dot</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-slate-500 mb-1">Center Dot Color</label>
                                <div class="color-input-wrapper">
                                    <input type="color" id="cornersDotColor" value="#312e81">
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <hr class="border-slate-100">

                <!-- Background & Logo -->
                <section>
                    <div class="flex items-center gap-2 mb-4">
                        <i data-lucide="image" class="w-4 h-4 text-indigo-600"></i>
                        <h3 class="font-semibold text-slate-800">Background & Logo</h3>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-medium text-slate-500 mb-1">Background Color</label>
                                <div class="color-input-wrapper">
                                    <input type="color" id="bgColor" value="#ffffff">
                                </div>
                            </div>
                            <div class="flex items-end">
                                <label class="flex items-center gap-2 cursor-pointer w-full h-10 px-4 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 transition text-sm text-slate-600 justify-center">
                                    <i data-lucide="upload" class="w-4 h-4"></i>
                                    <span>Upload Logo</span>
                                    <input type="file" id="logoInput" accept="image/*" class="hidden">
                                </label>
                            </div>
                        </div>
                        <div id="logoPreviewWrapper" class="hidden flex items-center gap-3 bg-slate-100 p-2 rounded-lg">
                            <span class="text-xs text-slate-500">Selected:</span>
                            <span id="logoFileName" class="text-xs font-medium text-slate-700 truncate max-w-[150px]">logo.png</span>
                            <button id="removeLogo" class="ml-auto text-red-500 hover:text-red-700 text-xs">Remove</button>
                        </div>
                    </div>
                </section>

            </div>
        </div>

        <!-- Right Panel: Preview -->
        <div class="flex-1 bg-slate-100 flex flex-col items-center justify-center p-6 relative overflow-y-auto">
            
            <div class="absolute top-6 right-6 hidden xl:block">
               <div class="bg-white/80 backdrop-blur text-xs text-slate-500 px-3 py-1 rounded-full border border-slate-200">
                  Live Preview
               </div>
            </div>

            <!-- The QR Canvas -->
            <div id="qr-code-container" class="mb-8 transition-all duration-300">
                <!-- Canvas injected here -->
            </div>

            <!-- Download Actions -->
            <div class="flex flex-col sm:flex-row items-center gap-4 w-full max-w-md">
                <div class="relative w-full">
                     <select id="fileExt" class="appearance-none w-full bg-white border border-slate-300 text-slate-700 py-3 px-4 pr-8 rounded-lg leading-tight focus:outline-none focus:bg-white focus:border-indigo-500">
                        <option value="png">PNG (High Res)</option>
                        <option value="jpeg">JPEG</option>
                        <option value="svg">SVG (Vector)</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-700">
                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </div>
                </div>
                
                <button id="downloadBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:shadow-indigo-500/30 transition-all flex items-center justify-center gap-2">
                    <i data-lucide="download" class="w-5 h-5"></i>
                    <span>Download</span>
                </button>
            </div>
            
            <p class="mt-4 text-xs text-slate-400 text-center max-w-xs">
                Generated locally in your browser. No data is sent to any server.
            </p>

        </div>
    </div>

    <script>
        // Initialize Icons
        lucide.createIcons();

        // State & Configuration
        let qrCode;
        let logoFile = null;

        // Helper to debounce updates for better performance
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        const getOptions = () => {
            const url = document.getElementById("urlInput").value || "https://example.com";
            const width = 1000; // High resolution internally
            const height = 1000;
            
            // Dots
            const dotsType = document.getElementById("dotsType").value;
            const dotsColor = document.getElementById("dotsColor").value;

            // Corners
            const cornersSquareType = document.getElementById("cornersSquareType").value;
            const cornersSquareColor = document.getElementById("cornersSquareColor").value;
            const cornersDotType = document.getElementById("cornersDotType").value;
            const cornersDotColor = document.getElementById("cornersDotColor").value;

            // Background
            const bgColor = document.getElementById("bgColor").value;

            const options = {
                width: width,
                height: height,
                type: "svg", // Default for crisp rendering, we can export as PNG
                data: url,
                image: logoFile,
                dotsOptions: {
                    color: dotsColor,
                    type: dotsType
                },
                backgroundOptions: {
                    color: bgColor,
                },
                imageOptions: {
                    crossOrigin: "anonymous",
                    margin: 10,
                    imageSize: 0.4 // Scale logo relative to QR
                },
                cornersSquareOptions: {
                    color: cornersSquareColor,
                    type: cornersSquareType
                },
                cornersDotOptions: {
                    color: cornersDotColor,
                    type: cornersDotType
                }
            };
            return options;
        };

        const initQR = () => {
            const options = getOptions();
            qrCode = new QRCodeStyling(options);
            const container = document.getElementById("qr-code-container");
            container.innerHTML = "";
            qrCode.append(container);
        };

        const updateQR = debounce(() => {
            if (!qrCode) return;
            const options = getOptions();
            qrCode.update(options);
        }, 100);

        // Apply Preset Function
        window.applyPreset = (type) => {
            if (type === 'fluid') {
                // Matches the user's "Red Liquid" image
                document.getElementById('dotsType').value = 'extra-rounded';
                document.getElementById('dotsColor').value = '#8B0000'; // Deep Red
                
                document.getElementById('cornersSquareType').value = 'extra-rounded';
                document.getElementById('cornersSquareColor').value = '#500000'; // Darker Red for contrast
                
                document.getElementById('cornersDotType').value = 'dot';
                document.getElementById('cornersDotColor').value = '#500000';
                
                document.getElementById('bgColor').value = '#ffffff';
            } else if (type === 'elegant') {
                // New: Matches the "Blue Classy" image
                document.getElementById('dotsType').value = 'classy-rounded';
                document.getElementById('dotsColor').value = '#0e3a75'; // Navy Blue
                
                document.getElementById('cornersSquareType').value = 'extra-rounded'; // Closest to the leaf shape
                document.getElementById('cornersSquareColor').value = '#0e3a75';
                
                document.getElementById('cornersDotType').value = 'dot';
                document.getElementById('cornersDotColor').value = '#0e3a75';
                
                document.getElementById('bgColor').value = '#ffffff';
            } else if (type === 'modern') {
                document.getElementById('dotsType').value = 'square';
                document.getElementById('dotsColor').value = '#4f46e5';
                
                document.getElementById('cornersSquareType').value = 'extra-rounded';
                document.getElementById('cornersSquareColor').value = '#312e81';
                
                document.getElementById('cornersDotType').value = 'square';
                document.getElementById('cornersDotColor').value = '#312e81';
                
                document.getElementById('bgColor').value = '#ffffff';
            } else if (type === 'dots') {
                document.getElementById('dotsType').value = 'dots';
                document.getElementById('dotsColor').value = '#059669';
                
                document.getElementById('cornersSquareType').value = 'dot';
                document.getElementById('cornersSquareColor').value = '#064e3b';
                
                document.getElementById('cornersDotType').value = 'dot';
                document.getElementById('cornersDotColor').value = '#064e3b';
                
                document.getElementById('bgColor').value = '#ecfdf5';
            }
            updateQR();
        }

        // Event Listeners
        const inputs = [
            "urlInput", "dotsType", "dotsColor", 
            "cornersSquareType", "cornersSquareColor", 
            "cornersDotType", "cornersDotColor", 
            "bgColor"
        ];

        inputs.forEach(id => {
            const el = document.getElementById(id);
            if(el) {
                el.addEventListener('input', updateQR);
                el.addEventListener('change', updateQR); // For selects
            }
        });

        // Logo Upload
        document.getElementById('logoInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    // Create an image to get dimensions
                    const img = new Image();
                    img.onload = () => {
                        // Create a canvas to crop the image into a circle
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');

                        // Use the smallest dimension for a perfect circle
                        const size = Math.min(img.width, img.height);
                        canvas.width = size;
                        canvas.height = size;

                        // Create circular clipping path
                        ctx.beginPath();
                        ctx.arc(size / 2, size / 2, size / 2, 0, Math.PI * 2);
                        ctx.closePath();
                        ctx.clip();

                        // Draw the image centered
                        const x = (size - img.width) / 2;
                        const y = (size - img.height) / 2;
                        ctx.drawImage(img, x, y);

                        // Set the new circular image as the logo
                        logoFile = canvas.toDataURL();

                        document.getElementById('logoFileName').textContent = file.name;
                        document.getElementById('logoPreviewWrapper').classList.remove('hidden');
                        updateQR();
                    };
                    img.src = event.target.result;
                }
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('removeLogo').addEventListener('click', function() {
            logoFile = null;
            document.getElementById('logoInput').value = ""; // reset file input
            document.getElementById('logoPreviewWrapper').classList.add('hidden');
            updateQR();
        });

        // Download
        document.getElementById('downloadBtn').addEventListener('click', () => {
            const ext = document.getElementById('fileExt').value;
            // Force a high resolution download if it's raster
            // The library uses the current options.
            // We set width/height to 1000 in getOptions, so it should be high res by default.
            qrCode.download({ name: "my-designer-qr", extension: ext });
        });

        // Initialize on load
        window.onload = initQR;

    </script>
</body>
</html>